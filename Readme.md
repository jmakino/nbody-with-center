User's Guide for nbody-with-center

                       2019/11/26 牧野

# はじめに

この文章では、 nbody-with-center の最低限の使い方について述べる。FDPS を使った惑星リング系計算のサンプルコードである。あんまりテストしてないのでちゃんとあってるかどうか知らない。

# コンパイル方法等

基本的に FDPS の sample/c++/nbody の下にある nbody.cpp と同じだが、

* PS_PATH を適切に (fdps の src があるディレクトリをさすように)設定す
  る
  
* PHANTOM_GRAPE はサポートされない

というあたりが違いである。PHANTOM_GRAPE がなくて遅いので、誰か改良して下さいな

# 実行

実行時オプションについて説明する

 -i: 入力スナップショットの名前。デフォルトはなしで、この時は
     -N オプションでなにか作られるがリング計算用にはなってない。
     入力ファイルの形式は

     time
     n
     id1 mass1 x1 y1 z1 vx1 vy1 vz1
     ...
     idn massn xn yn zn vxn vyn vzn

である。サンプルファイル ringin を見ること。

 -o: 出力ファイルを置くディレクトリである。デフォルトは ./results である。
     出力はスナップショット毎に別のファイルになる。形式は入力ファイル
     と同じ。

 -e: 衝突時のダンピング係数 eta である。デフォルトは 0

 -p: 重力ソフトニングである。デフォルトは 1/32
 
 -r: 粒子の物理半径である。デフォルトは0

 -k: 衝突時のバネ定数 kappa である。デフォルトは0

 -t: ツリーの見込み角 theta である。デフォルトは0

 -T: シミュレーション終了時刻である。デフォルトは10

 -s: 時間刻みである。デフォルトは 1/128

 -d: ログ出力の時間間隔である。デフォルトは 1/8
 
 -D: スナップショット出力の時間間隔である。デフォルトは 1
 
 -l: ツリーの leaf limit である。デフォルトは 8
 
 -M: 中心星の質量である。デフォルトは 1
 
 -n: ツリーの n_group_limit である。デフォルトは 64
 
 -N: 初期条件を生成する時の粒子数である。デフォルトは 1024。入力ファイ
     ルが指定されていると無視される。
     
  -h: ヘルプメッセージを出力して終了する。


# 初期条件生成

単に動いているかどうかの確認程度だが

 ring.rb

を実行すると、標準出力に、半径 1 から 1.1 の間に、半径方向に20個、角度
方向に 1000 個の粒子を、中心質量が1としてケプラー回転の速度を与えた粒
子を生成する。質量は 5e-8 である。引数に4個パラメータを m n dr massの
順番で与えると (m, n は半径方向及び角度方向) これらのパラメータを変更
できる。

# 実行例

    nbody-with-center -i ringin -o out -s 2e-4 -d 2e-3 -D 2e-3 -T 0.5 -e   10 -p 0 -r 0.004 -k 2e4 -M 1

出力の最後のほうが

    time:  0.4980073 energy error: -2.043143e-09
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    ekin, epot, etot= 0.00047664 -0.000954101 -0.000477461
    



